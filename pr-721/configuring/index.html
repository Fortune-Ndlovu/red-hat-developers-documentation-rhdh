<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Configuring</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.2"/><meta name="description" content="Learn how to configure Red Hat Developer Hub."/><link rel="next" href="#idm45552326271072" title="Preface"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm45552328596272"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red Hat Developer Hub</span> <span class="productnumber">1.4</span></div><div><h1 class="title">Configuring</h1></div><div><h2 class="subtitle">Configuring Red Hat Developer Hub</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm45552314718416">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				Learn how to configure Red Hat Developer Hub.
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="preface"><a href="#idm45552326271072">Preface</a></span></li><li><span class="chapter"><a href="#adding-custom-configuration-files">1. Adding custom configuration files to Red Hat Developer Hub</a></span><ul><li><span class="section"><a href="#proc-add-custom-app-config-file-ocp-operator_adding-custom-configuration-files">1.1. Adding custom Red Hat Developer Hub configuration files by using the operator</a></span></li><li><span class="section"><a href="#proc-add-custom-app-file-openshift-helm_adding-custom-configuration-files">1.2. Adding custom Red Hat Developer Hub configuration files by using the Helm chart</a></span></li></ul></li><li><span class="chapter"><a href="#configuring-external-postgresql-databases">2. Configuring external PostgreSQL databases</a></span><ul><li><span class="section"><a href="#proc-configuring-postgresql-instance-using-operator_configuring-external-postgresql-databases">2.1. Configuring an external PostgreSQL instance using the Operator</a></span></li><li><span class="section"><a href="#proc-configuring-postgresql-instance-using-helm_configuring-external-postgresql-databases">2.2. Configuring an external PostgreSQL instance using the Helm Chart</a></span></li><li><span class="section"><a href="#proc-migrating-databases-to-an-external-server_configuring-external-postgresql-databases">2.3. Migrating local databases to an external database server using the Operator</a></span></li></ul></li><li><span class="chapter"><a href="#running-behind-a-proxy">3. Running Red Hat Developer Hub behind a corporate proxy</a></span><ul><li><span class="section"><a href="#proc-configuring-proxy-in-operator-deployment_running-behind-a-proxy">3.1. Configuring proxy information in Operator deployment</a></span></li><li><span class="section"><a href="#proc-configuring-proxy-in-helm-deployment_running-behind-a-proxy">3.2. Configuring proxy information in Helm deployment</a></span></li></ul></li><li><span class="chapter"><a href="#proc-configuring-an-rhdh-instance-with-tls-in-kubernetes_running-behind-a-proxy">4. Configuring an RHDH instance with a TLS connection in Kubernetes</a></span></li><li><span class="chapter"><a href="#proc-rhdh-deployment-config_running-behind-a-proxy">5. Configuring Red Hat Developer Hub deployment by using the operator</a></span></li></ul></div><section class="preface" id="idm45552326271072"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p>
			Learn how to configure Red Hat Developer Hub.
		</p></section><section class="chapter" id="adding-custom-configuration-files"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Adding custom configuration files to Red Hat Developer Hub</h1></div></div></div><p>
			To configure Red Hat Developer Hub, add custom configuration files to Red Hat OpenShift Container Platform and register them in Developer Hub.
		</p><section class="section" id="proc-add-custom-app-config-file-ocp-operator_adding-custom-configuration-files"><div class="titlepage"><div><div><h2 class="title">1.1. Adding custom Red Hat Developer Hub configuration files by using the operator</h2></div></div></div><p>
				A custom application configuration file is a <code class="literal">ConfigMap</code> object that you can use to change the configuration of your Red Hat Developer Hub instance. If you are deploying your Developer Hub instance on Red Hat OpenShift Container Platform, you can use the Red Hat Developer Hub Operator to add a custom application configuration file to your OpenShift Container Platform instance by creating the <code class="literal">ConfigMap</code> object and referencing it in the Developer Hub custom resource (CR).
			</p><p>
				The custom application configuration file contains a sensitive environment variable, named <code class="literal">BACKEND_SECRET</code>. This variable contains a mandatory backend authentication key that Developer Hub uses to reference an environment variable defined in an OpenShift Container Platform secret. You must create a secret, named 'secrets-rhdh', and reference it in the Developer Hub CR.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					You are responsible for protecting your Red Hat Developer Hub installation from external and unauthorized access. Manage the backend authentication key like any other secret. Meet strong password requirements, do not expose it in any configuration files, and only inject it into configuration files as an environment variable.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have an active Red Hat OpenShift Container Platform account.
					</li><li class="listitem">
						Your administrator has installed the Red Hat Developer Hub Operator in OpenShift Container Platform. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.4/html-single/administration_guide_for_red_hat_developer_hub/index">Installing the Red Hat Developer Hub Operator</a>.
					</li><li class="listitem">
						You have created the Red Hat Developer Hub CR in OpenShift Container Platform.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						From the <span class="strong strong"><strong>Developer</strong></span> perspective in the OpenShift Container Platform web console, select the <span class="strong strong"><strong>Topology</strong></span> view, and click the <span class="strong strong"><strong>Open URL</strong></span> icon on the Developer Hub pod to identify your Developer Hub external URL: <span class="emphasis"><em>&lt;RHDH_URL&gt;</em></span>.
					</li><li class="listitem">
						From the <span class="strong strong"><strong>Developer</strong></span> perspective in the OpenShift Container Platform web console, select the <span class="strong strong"><strong>ConfigMaps</strong></span> view.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Create ConfigMap</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Select the <span class="strong strong"><strong>YAML view</strong></span> option in <span class="strong strong"><strong>Configure via</strong></span> and use the following example as a base template to create a <code class="literal">ConfigMap</code> object, such as <code class="literal">app-config-rhdh.yaml</code>:
					</p><pre class="programlisting language-yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
    app:
      title: Red Hat Developer Hub
      baseUrl: &lt;RHDH_URL&gt; <span id="CO1-1"/><span class="callout">1</span>
    backend:
      auth:
        externalAccess:
            - type: legacy
              options:
                subject: legacy-default-config
                secret: "${BACKEND_SECRET}" <span id="CO1-2"/><span class="callout">2</span>
      baseUrl: &lt;RHDH_URL&gt; <span id="CO1-3"/><span class="callout">3</span>
      cors:
        origin: &lt;RHDH_URL&gt; <span id="CO1-4"/><span class="callout">4</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO1-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Set the external URL of your Red Hat Developer Hub instance.
							</div></dd><dt><a href="#CO1-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Use an environment variable exposing an OpenShift Container Platform secret to define the mandatory Developer Hub backend authentication key.
							</div></dd><dt><a href="#CO1-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Set the external URL of your Red Hat Developer Hub instance.
							</div></dd><dt><a href="#CO1-4"><span class="callout">4</span></a> </dt><dd><div class="para">
								Set the external URL of your Red Hat Developer Hub instance.
							</div></dd></dl></div></li><li class="listitem">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</li><li class="listitem">
						Select the <span class="strong strong"><strong>Secrets</strong></span> view.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Create Key/value Secret</strong></span>.
					</li><li class="listitem">
						Create a secret named <code class="literal">secrets-rhdh</code>.
					</li><li class="listitem"><p class="simpara">
						Add a key named <code class="literal">BACKEND_SECRET</code> and a base64 encoded string as a value. Use a unique value for each Red Hat Developer Hub instance. For example, you can use the following command to generate a key from your terminal:
					</p><pre class="programlisting language-yaml">node -p 'require("crypto").randomBytes(24).toString("base64")'</pre></li><li class="listitem">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</li><li class="listitem">
						Select the <span class="strong strong"><strong>Topology</strong></span> view.
					</li><li class="listitem"><p class="simpara">
						Click the overflow menu for the Red Hat Developer Hub instance that you want to use and select <span class="strong strong"><strong>Edit Backstage</strong></span> to load the YAML view of the Red Hat Developer Hub instance.
					</p><div class="informalfigure"><div class="mediaobject"><img src="images/rhdh/operator-install-2.png" alt="operator install 2"/></div></div></li><li class="listitem"><p class="simpara">
						In the CR, enter the name of the custom application configuration config map as the value for the <code class="literal">spec.application.appConfig.configMaps</code> field, and enter the name of your secret as the value for the <code class="literal">spec.application.extraEnvs.secrets</code> field. For example:
					</p><pre class="programlisting language-yaml">apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
  name: developer-hub
spec:
  application:
    appConfig:
      mountPath: /opt/app-root/src
      configMaps:
         - name: app-config-rhdh
    extraEnvs:
      secrets:
         - name: secrets-rhdh
    extraFiles:
      mountPath: /opt/app-root/src
    replicas: 1
    route:
      enabled: true
  database:
    enableLocalDb: true</pre></li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li><li class="listitem">
						Navigate back to the <span class="strong strong"><strong>Topology</strong></span> view and wait for the Red Hat Developer Hub pod to start.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong>Open URL</strong></span> icon to use the Red Hat Developer Hub platform with the configuration changes.
					</li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						For more information about roles and responsibilities in Developer Hub, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.4/html-single/administration_guide_for_red_hat_developer_hub/index">Role-Based Access Control (RBAC) in Red Hat Developer Hub</a>.
					</li></ul></div></section><section class="section" id="proc-add-custom-app-file-openshift-helm_adding-custom-configuration-files"><div class="titlepage"><div><div><h2 class="title">1.2. Adding custom Red Hat Developer Hub configuration files by using the Helm chart</h2></div></div></div><p>
				You can use the Red Hat Developer Hub Helm chart to add a custom application configuration file to your OpenShift Container Platform instance.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have created an Red Hat OpenShift Container Platform account.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						From the OpenShift Container Platform web console, select the <span class="strong strong"><strong>ConfigMaps</strong></span> tab.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Create ConfigMap</strong></span>.
					</li><li class="listitem">
						From <span class="strong strong"><strong>Create ConfigMap</strong></span> page, select the <span class="strong strong"><strong>YAML view</strong></span> option in <span class="strong strong"><strong>Configure via</strong></span> and make changes to the file, if needed.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Create</strong></span>.
					</li><li class="listitem">
						Go to the <span class="strong strong"><strong>Helm</strong></span> tab to see the list of Helm releases.
					</li><li class="listitem">
						Click the overflow menu on the Helm release that you want to use and select <span class="strong strong"><strong>Upgrade</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Use either the <span class="strong strong"><strong>Form view</strong></span> or <span class="strong strong"><strong>YAML view</strong></span> to edit the Helm configuration.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Using <span class="strong strong"><strong>Form view</strong></span>
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Expand <span class="strong strong"><strong>Root Schema → Backstage chart schema → Backstage parameters → Extra app configuration files to inline into command arguments</strong></span>.
									</li><li class="listitem">
										Click the <span class="strong strong"><strong>Add Extra app configuration files to inline into command arguments</strong></span> link.
									</li><li class="listitem"><p class="simpara">
										Enter the value in the following fields:
									</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
												<span class="strong strong"><strong>configMapRef</strong></span>: <code class="literal">app-config-rhdh</code>
											</li><li class="listitem">
												<span class="strong strong"><strong>filename</strong></span>: <code class="literal">app-config-rhdh.yaml</code>
											</li></ul></div></li><li class="listitem">
										Click <span class="strong strong"><strong>Upgrade</strong></span>.
									</li></ol></div></li><li class="listitem"><p class="simpara">
								Using <span class="strong strong"><strong>YAML view</strong></span>
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
										Set the value of the <code class="literal">upstream.backstage.extraAppConfig.configMapRef</code> and <code class="literal">upstream.backstage.extraAppConfig.filename</code> parameters as follows:
									</p><pre class="programlisting language-yaml"># ... other Red Hat Developer Hub Helm Chart configurations
upstream:
  backstage:
    extraAppConfig:
      - configMapRef: app-config-rhdh
        filename: app-config-rhdh.yaml
# ... other Red Hat Developer Hub Helm Chart configurations</pre></li><li class="listitem">
										Click <span class="strong strong"><strong>Upgrade</strong></span>.
									</li></ol></div></li></ul></div></li></ol></div></section></section><section class="chapter" id="configuring-external-postgresql-databases"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Configuring external PostgreSQL databases</h1></div></div></div><p>
			As an administrator, you can configure and use external PostgreSQL databases in Red Hat Developer Hub. You can use a PostgreSQL certificate file to configure an external PostgreSQL instance using the Operator or Helm Chart.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				Developer Hub supports the configuration of external PostgreSQL databases. You can perform maintenance activities, such as backing up your data or configuring high availability (HA) for the external PostgreSQL databases.
			</p><p>
				By default, the Red Hat Developer Hub operator or Helm Chart creates a local PostgreSQL database. However, this configuration is not suitable for the production environments. For production deployments, disable the creation of local database and configure Developer Hub to connect to an external PostgreSQL instance instead.
			</p></div></div><section class="section" id="proc-configuring-postgresql-instance-using-operator_configuring-external-postgresql-databases"><div class="titlepage"><div><div><h2 class="title">2.1. Configuring an external PostgreSQL instance using the Operator</h2></div></div></div><p>
				You can configure an external PostgreSQL instance using the Red Hat Developer Hub Operator. By default, the Operator creates and manages a local instance of PostgreSQL in the same namespace where you have deployed the RHDH instance. However, you can change this default setting to configure an external PostgreSQL database server, for example, Amazon Web Services (AWS) Relational Database Service (RDS) or Azure database.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You are using a supported version of PostgreSQL. For more information, see the <a class="link" href="https://access.redhat.com/support/policy/updates/developerhub">Product life cycle page</a>.
					</li><li class="listitem"><p class="simpara">
						You have the following details:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">db-host</code>: Denotes your PostgreSQL instance Domain Name System (DNS) or IP address
							</li><li class="listitem">
								<code class="literal">db-port</code>: Denotes your PostgreSQL instance port number, such as <code class="literal">5432</code>
							</li><li class="listitem">
								<code class="literal">username</code>: Denotes the user name to connect to your PostgreSQL instance
							</li><li class="listitem">
								<code class="literal">password</code>: Denotes the password to connect to your PostgreSQL instance
							</li></ul></div></li><li class="listitem">
						You have installed the Red Hat Developer Hub Operator.
					</li><li class="listitem">
						Optional: You have a CA certificate, Transport Layer Security (TLS) private key, and TLS certificate so that you can secure your database connection by using the TLS protocol. For more information, refer to your PostgreSQL vendor documentation.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					By default, Developer Hub uses a database for each plugin and automatically creates it if none is found. You might need the <code class="literal">Create Database</code> privilege in addition to <code class="literal">PSQL Database</code> privileges for configuring an external PostgreSQL instance.
				</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Optional: Create a certificate secret to configure your PostgreSQL instance with a TLS connection:
					</p><pre class="programlisting language-yaml">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;crt-secret&gt; <span id="CO2-1"/><span class="callout">1</span>
type: Opaque
stringData:
 postgres-ca.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;ca-certificate-key&gt; <span id="CO2-2"/><span class="callout">2</span>
 postgres-key.key: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-private-key&gt; <span id="CO2-3"/><span class="callout">3</span>
 postgres-crt.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-certificate-key&gt; <span id="CO2-4"/><span class="callout">4</span>
  # ...
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO2-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Provide the name of the certificate secret.
							</div></dd><dt><a href="#CO2-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Provide the CA certificate key.
							</div></dd><dt><a href="#CO2-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Optional: Provide the TLS private key.
							</div></dd><dt><a href="#CO2-4"><span class="callout">4</span></a> </dt><dd><div class="para">
								Optional: Provide the TLS certificate key.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a credential secret to connect with the PostgreSQL instance:
					</p><pre class="programlisting language-yaml">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;cred-secret&gt; <span id="CO3-1"/><span class="callout">1</span>
type: Opaque
stringData: <span id="CO3-2"/><span class="callout">2</span>
 POSTGRES_PASSWORD: &lt;password&gt;
 POSTGRES_PORT: "&lt;db-port&gt;"
 POSTGRES_USER: &lt;username&gt;
 POSTGRES_HOST: &lt;db-host&gt;
 PGSSLMODE: &lt;ssl-mode&gt; # for TLS connection <span id="CO3-3"/><span class="callout">3</span>
 NODE_EXTRA_CA_CERTS: &lt;abs-path-to-pem-file&gt; # for TLS connection, e.g. /opt/app-root/src/postgres-crt.pem <span id="CO3-4"/><span class="callout">4</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO3-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Provide the name of the credential secret.
							</div></dd><dt><a href="#CO3-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Provide credential data to connect with your PostgreSQL instance.
							</div></dd><dt><a href="#CO3-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Optional: Provide the value based on the required <a class="link" href="https://www.postgresql.org/docs/15/libpq-connect.html#LIBPQ-CONNECT-SSLMODE">Secure Sockets Layer (SSL) mode</a>.
							</div></dd><dt><a href="#CO3-4"><span class="callout">4</span></a> </dt><dd><div class="para">
								Optional: Provide the value only if you need a TLS connection for your PostgreSQL instance.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">Backstage</code> custom resource (CR):
					</p><pre class="programlisting language-terminal">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: rhdh.redhat.com/v1alpha1
kind: Backstage
metadata:
  name: &lt;backstage-instance-name&gt;
spec:
  database:
    enableLocalDb: false <span id="CO4-1"/><span class="callout">1</span>
  application:
    extraFiles:
      mountPath: &lt;path&gt; # e g /opt/app-root/src
      secrets:
        - name: &lt;crt-secret&gt; <span id="CO4-2"/><span class="callout">2</span>
          key: postgres-crt.pem, postgres-ca.pem, postgres-key.key # key name as in &lt;crt-secret&gt; Secret
    extraEnvs:
      secrets:
        - name: &lt;cred-secret&gt; <span id="CO4-3"/><span class="callout">3</span>
        # ...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO4-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Set the value of the <code class="literal">enableLocalDb</code> parameter to <code class="literal">false</code> to disable creating local PostgreSQL instances.
							</div></dd><dt><a href="#CO4-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Provide the name of the certificate secret if you have configured a TLS connection.
							</div></dd><dt><a href="#CO4-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Provide the name of the credential secret that you created.
							</div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The environment variables listed in the <code class="literal">Backstage</code> CR work with the Operator default configuration. If you have changed the Operator default configuration, you must reconfigure the <code class="literal">Backstage</code> CR accordingly.
						</p></div></div></li><li class="listitem">
						Apply the <code class="literal">Backstage</code> CR to the namespace where you have deployed the RHDH instance.
					</li></ol></div></section><section class="section" id="proc-configuring-postgresql-instance-using-helm_configuring-external-postgresql-databases"><div class="titlepage"><div><div><h2 class="title">2.2. Configuring an external PostgreSQL instance using the Helm Chart</h2></div></div></div><p>
				You can configure an external PostgreSQL instance by using the Helm Chart. By default, the Helm Chart creates and manages a local instance of PostgreSQL in the same namespace where you have deployed the RHDH instance. However, you can change this default setting to configure an external PostgreSQL database server, for example, Amazon Web Services (AWS) Relational Database Service (RDS) or Azure database.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You are using a supported version of PostgreSQL. For more information, see the <a class="link" href="https://access.redhat.com/support/policy/updates/developerhub">Product life cycle page</a>.
					</li><li class="listitem"><p class="simpara">
						You have the following details:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">db-host</code>: Denotes your PostgreSQL instance Domain Name System (DNS) or IP address
							</li><li class="listitem">
								<code class="literal">db-port</code>: Denotes your PostgreSQL instance port number, such as <code class="literal">5432</code>
							</li><li class="listitem">
								<code class="literal">username</code>: Denotes the user name to connect to your PostgreSQL instance
							</li><li class="listitem">
								<code class="literal">password</code>: Denotes the password to connect to your PostgreSQL instance
							</li></ul></div></li><li class="listitem">
						You have installed the RHDH application by using the Helm Chart.
					</li><li class="listitem">
						Optional: You have a CA certificate, Transport Layer Security (TLS) private key, and TLS certificate so that you can secure your database connection by using the TLS protocol. For more information, refer to your PostgreSQL vendor documentation.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					By default, Developer Hub uses a database for each plugin and automatically creates it if none is found. You might need the <code class="literal">Create Database</code> privilege in addition to <code class="literal">PSQL Database</code> privileges for configuring an external PostgreSQL instance.
				</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Optional: Create a certificate secret to configure your PostgreSQL instance with a TLS connection:
					</p><pre class="programlisting language-terminal">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;crt-secret&gt; <span id="CO5-1"/><span class="callout">1</span>
type: Opaque
stringData:
 postgres-ca.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;ca-certificate-key&gt; <span id="CO5-2"/><span class="callout">2</span>
 postgres-key.key: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-private-key&gt; <span id="CO5-3"/><span class="callout">3</span>
 postgres-crt.pem: |-
  -----BEGIN CERTIFICATE-----
  &lt;tls-certificate-key&gt; <span id="CO5-4"/><span class="callout">4</span>
  # ...
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO5-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Provide the name of the certificate secret.
							</div></dd><dt><a href="#CO5-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Provide the CA certificate key.
							</div></dd><dt><a href="#CO5-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Optional: Provide the TLS private key.
							</div></dd><dt><a href="#CO5-4"><span class="callout">4</span></a> </dt><dd><div class="para">
								Optional: Provide the TLS certificate key.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a credential secret to connect with the PostgreSQL instance:
					</p><pre class="programlisting language-terminal">cat &lt;&lt;EOF | oc -n &lt;your-namespace&gt; create -f -
apiVersion: v1
kind: Secret
metadata:
 name: &lt;cred-secret&gt; <span id="CO6-1"/><span class="callout">1</span>
type: Opaque
stringData: <span id="CO6-2"/><span class="callout">2</span>
 POSTGRES_PASSWORD: &lt;password&gt;
 POSTGRES_PORT: "&lt;db-port&gt;"
 POSTGRES_USER: &lt;username&gt;
 POSTGRES_HOST: &lt;db-host&gt;
 PGSSLMODE: &lt;ssl-mode&gt; # for TLS connection <span id="CO6-3"/><span class="callout">3</span>
 NODE_EXTRA_CA_CERTS: &lt;abs-path-to-pem-file&gt; # for TLS connection, e.g. /opt/app-root/src/postgres-crt.pem <span id="CO6-4"/><span class="callout">4</span>
EOF</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO6-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Provide the name of the credential secret.
							</div></dd><dt><a href="#CO6-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Provide credential data to connect with your PostgreSQL instance.
							</div></dd><dt><a href="#CO6-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Optional: Provide the value based on the required <a class="link" href="https://www.postgresql.org/docs/15/libpq-connect.html#LIBPQ-CONNECT-SSLMODE">Secure Sockets Layer (SSL) mode</a>.
							</div></dd><dt><a href="#CO6-4"><span class="callout">4</span></a> </dt><dd><div class="para">
								Optional: Provide the value only if you need a TLS connection for your PostgreSQL instance.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Configure your PostgreSQL instance in the Helm configuration file named <code class="literal">values.yaml</code>:
					</p><pre class="programlisting language-yaml"># ...
upstream:
  postgresql:
    enabled: false  # disable PostgreSQL instance creation <span id="CO7-1"/><span class="callout">1</span>
    auth:
      existingSecret: &lt;cred-secret&gt; # inject credentials secret to Backstage <span id="CO7-2"/><span class="callout">2</span>
  backstage:
    appConfig:
      backend:
        database:
          connection:  # configure Backstage DB connection parameters
            host: ${POSTGRES_HOST}
            port: ${POSTGRES_PORT}
            user: ${POSTGRES_USER}
            password: ${POSTGRES_PASSWORD}
            ssl:
              rejectUnauthorized: true,
              ca:
                $file: /opt/app-root/src/postgres-ca.pem
              key:
                $file: /opt/app-root/src/postgres-key.key
              cert:
                $file: /opt/app-root/src/postgres-crt.pem
  extraEnvVarsSecrets:
    - &lt;cred-secret&gt; # inject credentials secret to Backstage <span id="CO7-3"/><span class="callout">3</span>
  extraEnvVars:
    - name: BACKEND_SECRET
      valueFrom:
        secretKeyRef:
          key: backend-secret
          name: '{{ include "janus-idp.backend-secret-name" $ }}'
  extraVolumeMounts:
    - mountPath: /opt/app-root/src/dynamic-plugins-root
      name: dynamic-plugins-root
    - mountPath: /opt/app-root/src/postgres-crt.pem
      name: postgres-crt # inject TLS certificate to Backstage cont. <span id="CO7-4"/><span class="callout">4</span>
      subPath: postgres-crt.pem
    - mountPath: /opt/app-root/src/postgres-ca.pem
      name: postgres-ca # inject CA certificate to Backstage cont. <span id="CO7-5"/><span class="callout">5</span>
      subPath: postgres-ca.pem
    - mountPath: /opt/app-root/src/postgres-key.key
      name: postgres-key # inject TLS private key to Backstage cont. <span id="CO7-6"/><span class="callout">6</span>
      subPath: postgres-key.key
  extraVolumes:
    - ephemeral:
        volumeClaimTemplate:
          spec:
            accessModes:
              - ReadWriteOnce
            resources:
              requests:
                storage: 1Gi
      name: dynamic-plugins-root
    - configMap:
        defaultMode: 420
        name: dynamic-plugins
        optional: true
      name: dynamic-plugins
    - name: dynamic-plugins-npmrc
      secret:
        defaultMode: 420
        optional: true
        secretName: dynamic-plugins-npmrc
    - name: postgres-crt
      secret:
        secretName: &lt;crt-secret&gt; <span id="CO7-7"/><span class="callout">7</span>
        # ...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO7-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								Set the value of the <code class="literal">upstream.postgresql.enabled</code> parameter to <code class="literal">false</code> to disable creating local PostgreSQL instances.
							</div></dd><dt><a href="#CO7-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								Provide the name of the credential secret.
							</div></dd><dt><a href="#CO7-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								Provide the name of the credential secret.
							</div></dd><dt><a href="#CO7-4"><span class="callout">4</span></a> </dt><dd><div class="para">
								Optional: Provide the name of the TLS certificate only for a TLS connection.
							</div></dd><dt><a href="#CO7-5"><span class="callout">5</span></a> </dt><dd><div class="para">
								Optional: Provide the name of the CA certificate only for a TLS connection.
							</div></dd><dt><a href="#CO7-6"><span class="callout">6</span></a> </dt><dd><div class="para">
								Optional: Provide the name of the TLS private key only if your TLS connection requires a private key.
							</div></dd><dt><a href="#CO7-7"><span class="callout">7</span></a> </dt><dd><div class="para">
								Provide the name of the certificate secret if you have configured a TLS connection.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Apply the configuration changes in your Helm configuration file named <code class="literal">values.yaml</code>:
					</p><pre class="programlisting language-terminal">helm upgrade -n &lt;your-namespace&gt; &lt;your-deploy-name&gt; openshift-helm-charts/redhat-developer-hub -f values.yaml --version 1.4.0</pre></li></ol></div></section><section class="section" id="proc-migrating-databases-to-an-external-server_configuring-external-postgresql-databases"><div class="titlepage"><div><div><h2 class="title">2.3. Migrating local databases to an external database server using the Operator</h2></div></div></div><p>
				By default, Red Hat Developer Hub hosts the data for each plugin in a PostgreSQL database. When you fetch the list of databases, you might see multiple databases based on the number of plugins configured in Developer Hub. You can migrate the data from an RHDH instance hosted on a local PostgreSQL server to an external PostgreSQL service, such as AWS RDS, Azure database, or Crunchy database. To migrate the data from each RHDH instance, you can use PostgreSQL utilities, such as <a class="link" href="https://www.postgresql.org/docs/current/app-pgdump.html"><code class="literal">pg_dump</code></a> with <a class="link" href="https://www.postgresql.org/docs/current/app-psql.html"><code class="literal">psql</code></a> or <a class="link" href="https://www.pgadmin.org/"><code class="literal">pgAdmin</code></a>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The following procedure uses a database copy script to do a quick migration.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed the <a class="link" href="https://www.postgresql.org/docs/current/app-pgdump.html"><code class="literal">pg_dump</code></a> and <a class="link" href="https://www.postgresql.org/docs/current/app-psql.html"><code class="literal">psql</code></a> utilities on your local machine.
					</li><li class="listitem">
						For data export, you have the PGSQL user privileges to make a full dump of local databases.
					</li><li class="listitem">
						For data import, you have the PGSQL admin privileges to create an external database and populate it with database dumps.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure port forwarding for the local PostgreSQL database pod by running the following command on a terminal:
					</p><pre class="programlisting language-terminal">oc port-forward -n &lt;your-namespace&gt; &lt;pgsql-pod-name&gt; &lt;forward-to-port&gt;:&lt;forward-from-port&gt;</pre><p class="simpara">
						Where:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The <code class="literal">&lt;pgsql-pod-name&gt;</code> variable denotes the name of a PostgreSQL pod with the format <code class="literal">backstage-psql-&lt;deployment-name&gt;-&lt;_index&gt;</code>.
							</li><li class="listitem">
								The <code class="literal">&lt;forward-to-port&gt;</code> variable denotes the port of your choice to forward PostgreSQL data to.
							</li><li class="listitem"><p class="simpara">
								The <code class="literal">&lt;forward-from-port&gt;</code> variable denotes the local PostgreSQL instance port, such as <code class="literal">5432</code>.
							</p><div class="formalpara"><p class="title"><strong>Example: Configuring port forwarding</strong></p><p>
									
<pre class="programlisting language-terminal">oc port-forward -n developer-hub backstage-psql-developer-hub-0 15432:5432</pre>
								</p></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Make a copy of the following <code class="literal">db_copy.sh</code> script and edit the details based on your configuration:
					</p><pre class="programlisting language-bash">#!/bin/bash

to_host=&lt;db-service-host&gt; <span id="CO8-1"/><span class="callout">1</span>
to_port=5432 <span id="CO8-2"/><span class="callout">2</span>
to_user=postgres <span id="CO8-3"/><span class="callout">3</span>

from_host=127.0.0.1 <span id="CO8-4"/><span class="callout">4</span>
from_port=15432 <span id="CO8-5"/><span class="callout">5</span>
from_user=postgres <span id="CO8-6"/><span class="callout">6</span>

allDB=("backstage_plugin_app" "backstage_plugin_auth" "backstage_plugin_catalog" "backstage_plugin_permission" "backstage_plugin_scaffolder" "backstage_plugin_search") <span id="CO8-7"/><span class="callout">7</span>

for db in ${!allDB[@]};
do
  db=${allDB[$db]}
  echo Copying database: $db
  PGPASSWORD=$TO_PSW psql -h $to_host -p $to_port -U $to_user -c "create database $db;"
  pg_dump -h $from_host -p $from_port -U $from_user -d $db | PGPASSWORD=$TO_PSW psql -h $to_host -p $to_port -U $to_user -d $db
done</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO8-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								The destination host name, for example, <code class="literal">&lt;db-instance-name&gt;.rds.amazonaws.com</code>.
							</div></dd><dt><a href="#CO8-2"><span class="callout">2</span></a> </dt><dd><div class="para">
								The destination port, such as <code class="literal">5432</code>.
							</div></dd><dt><a href="#CO8-3"><span class="callout">3</span></a> </dt><dd><div class="para">
								The destination server username, for example, <code class="literal">postgres</code>.
							</div></dd><dt><a href="#CO8-4"><span class="callout">4</span></a> </dt><dd><div class="para">
								The source host name, such as <code class="literal">127.0.0.1</code>.
							</div></dd><dt><a href="#CO8-5"><span class="callout">5</span></a> </dt><dd><div class="para">
								The source port number, such as the <code class="literal">&lt;forward-to-port&gt;</code> variable.
							</div></dd><dt><a href="#CO8-6"><span class="callout">6</span></a> </dt><dd><div class="para">
								The source server username, for example, <code class="literal">postgres</code>.
							</div></dd><dt><a href="#CO8-7"><span class="callout">7</span></a> </dt><dd><div class="para">
								The name of databases to import in double quotes separated by spaces, for example, <code class="literal">("backstage_plugin_app" "backstage_plugin_auth" "backstage_plugin_catalog" "backstage_plugin_permission" "backstage_plugin_scaffolder" "backstage_plugin_search")</code>.
							</div></dd></dl></div></li><li class="listitem"><p class="simpara">
						Create a destination database for copying the data:
					</p><pre class="programlisting language-terminal">/bin/bash TO_PSW=&lt;destination-db-password&gt; /path/to/db_copy.sh <span id="CO9-1"/><span class="callout">1</span></pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO9-1"><span class="callout">1</span></a> </dt><dd><div class="para">
								The <code class="literal">&lt;destination-db-password&gt;</code> variable denotes the password to connect to the destination database.
							</div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							You can stop port forwarding when the copying of the data is complete. For more information about handling large databases and using the compression tools, see the <a class="link" href="https://www.postgresql.org/docs/current/backup-dump.html#BACKUP-DUMP-LARGE">Handling Large Databases</a> section on the PostgreSQL website.
						</p></div></div></li><li class="listitem">
						Reconfigure your <code class="literal">Backstage</code> custom resource (CR). For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_developer_hub/1.4/html-single/administration_guide_for_red_hat_developer_hub/index#proc-configuring-postgresql-instance-using-operator_admin-rhdh">Configuring an external PostgreSQL instance using the Operator</a>.
					</li><li class="listitem"><p class="simpara">
						Check that the following code is present at the end of your <code class="literal">Backstage</code> CR after reconfiguration:
					</p><pre class="programlisting language-yaml"># ...
spec:
  database:
    enableLocalDb: false
  application:
  # ...
    extraFiles:
      secrets:
        - name: &lt;crt-secret&gt;
          key: postgres-crt.pem # key name as in &lt;crt-secret&gt; Secret
    extraEnvs:
      secrets:
        - name: &lt;cred-secret&gt;
# ...</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Reconfiguring the <code class="literal">Backstage</code> CR deletes the corresponding <code class="literal">StatefulSet</code> and <code class="literal">Pod</code> objects, but does not delete the <code class="literal">PersistenceVolumeClaim</code> object. Use the following command to delete the local <code class="literal">PersistenceVolumeClaim</code> object:
						</p><pre class="programlisting language-terminal">oc -n developer-hub delete pvc &lt;local-psql-pvc-name&gt;</pre><p>
							where, the <code class="literal">&lt;local-psql-pvc-name&gt;</code> variable is in the <code class="literal">data-&lt;psql-pod-name&gt;</code> format.
						</p></div></div></li><li class="listitem">
						Apply the configuration changes.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Verify that your RHDH instance is running with the migrated data and does not contain the local PostgreSQL database by running the following command:
					</p><pre class="programlisting language-terminal">oc get pods -n &lt;your-namespace&gt;</pre></li><li class="listitem"><p class="simpara">
						Check the output for the following details:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The <code class="literal">backstage-developer-hub-xxx</code> pod is in running state.
							</li><li class="listitem"><p class="simpara">
								The <code class="literal">backstage-psql-developer-hub-0</code> pod is not available.
							</p><p class="simpara">
								You can also verify these details using the <span class="strong strong"><strong>Topology</strong></span> view in the OpenShift Container Platform web console.
							</p></li></ul></div></li></ol></div></section></section><section class="chapter" id="running-behind-a-proxy"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Running Red Hat Developer Hub behind a corporate proxy</h1></div></div></div><p>
			In a network restricted environment, configure Red Hat Developer Hub to use your proxy to access remote network resources.
		</p><p>
			You can run the RHDH application behind a corporate proxy by setting any of the following environment variables before starting the application:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					<code class="literal">HTTP_PROXY</code>: Denotes the proxy to use for HTTP requests.
				</li><li class="listitem">
					<code class="literal">HTTPS_PROXY</code>: Denotes the proxy to use for HTTPS requests.
				</li></ul></div><p>
			Additionally, you can set the <code class="literal">NO_PROXY</code> environment variable to exclude certain domains from proxying. The variable value is a comma-separated list of hostnames that do not require a proxy to get reached, even if one is specified.
		</p><section class="section" id="proc-configuring-proxy-in-operator-deployment_running-behind-a-proxy"><div class="titlepage"><div><div><h2 class="title">3.1. Configuring proxy information in Operator deployment</h2></div></div></div><p>
				For Operator-based deployment, the approach you use for proxy configuration is based on your role:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						As a cluster administrator with access to the Operator namespace, you can configure the proxy variables in the Operator’s default ConfigMap file. This configuration applies the proxy settings to all the users of the Operator.
					</li><li class="listitem">
						As a developer, you can configure the proxy variables in a custom resource (CR) file. This configuration applies the proxy settings to the RHDH application created from that CR.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed the Red Hat Developer Hub application.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Perform one of the following steps based on your role:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								As an administrator, set the proxy information in the Operator’s default ConfigMap file:
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Search for a ConfigMap file named <code class="literal">backstage-default-config</code> in the default namespace <code class="literal">rhdh-operator</code> and open it.
									</li><li class="listitem">
										Find the <code class="literal">deployment.yaml</code> key.
									</li><li class="listitem"><p class="simpara">
										Set the value of the <code class="literal">HTTP_PROXY</code>, <code class="literal">HTTPS_PROXY</code>, and <code class="literal">NO_PROXY</code> environment variables in the <code class="literal">Deployment</code> spec as shown in the following example:
									</p><div class="formalpara"><p class="title"><strong>Example: Setting proxy variables in a ConfigMap file</strong></p><p>
											
<pre class="programlisting language-yaml"># Other fields omitted
  deployment.yaml: |-
    apiVersion: apps/v1
    kind: Deployment
    spec:
      template:
        spec:
          # Other fields omitted
          initContainers:
            - name: install-dynamic-plugins
              # command omitted
              env:
                - name: NPM_CONFIG_USERCONFIG
                  value: /opt/app-root/src/.npmrc.dynamic-plugins
                - name: HTTP_PROXY
                  value: 'http://10.10.10.105:3128'
                - name: HTTPS_PROXY
                  value: 'http://10.10.10.106:3128'
                - name: NO_PROXY
                  value: 'localhost,example.org'
              # Other fields omitted
          containers:
            - name: backstage-backend
              # Other fields omitted
              env:
                - name: APP_CONFIG_backend_listen_port
                  value: "7007"
                - name: HTTP_PROXY
                  value: 'http://10.10.10.105:3128'
                - name: HTTPS_PROXY
                  value: 'http://10.10.10.106:3128'
                - name: NO_PROXY
                  value: 'localhost,example.org'</pre>
										</p></div></li></ol></div></li><li class="listitem"><p class="simpara">
								As a developer, set the proxy information in your custom resource (CR) file as shown in the following example:
							</p><div class="formalpara"><p class="title"><strong>Example: Setting proxy variables in a CR file</strong></p><p>
									
<pre class="programlisting language-yaml">spec:
  # Other fields omitted
  application:
    extraEnvs:
      envs:
        - name: HTTP_PROXY
          value: 'http://10.10.10.105:3128'
        - name: HTTPS_PROXY
          value: 'http://10.10.10.106:3128'
        - name: NO_PROXY
          value: 'localhost,example.org'</pre>
								</p></div></li></ul></div></li><li class="listitem">
						Save the configuration changes.
					</li></ol></div></section><section class="section" id="proc-configuring-proxy-in-helm-deployment_running-behind-a-proxy"><div class="titlepage"><div><div><h2 class="title">3.2. Configuring proxy information in Helm deployment</h2></div></div></div><p>
				For Helm-based deployment, either a developer or a cluster administrator with permissions to create resources in the cluster can configure the proxy variables in a <code class="literal">values.yaml</code> Helm configuration file.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed the Red Hat Developer Hub application.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Set the proxy information in your Helm configuration file:
					</p><pre class="programlisting language-yaml">upstream:
  backstage:
    extraEnvVars:
      - name: HTTP_PROXY
        value: '&lt;http_proxy_url&gt;'
      - name: HTTPS_PROXY
        value: '&lt;https_proxy_url&gt;'
      - name: NO_PROXY
        value: '&lt;no_proxy_settings&gt;'</pre><p class="simpara">
						Where,
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">&lt;http_proxy_url&gt;</code></span></dt><dd>
									Denotes a variable that you must replace with the HTTP proxy URL.
								</dd><dt><span class="term"><code class="literal">&lt;https_proxy_url&gt;</code></span></dt><dd>
									Denotes a variable that you must replace with the HTTPS proxy URL.
								</dd><dt><span class="term"><code class="literal">&lt;no_proxy_settings&gt;</code></span></dt><dd><p class="simpara">
									Denotes a variable that you must replace with comma-separated URLs, which you want to exclude from proxying, for example, <code class="literal">foo.com,baz.com</code>.
								</p><div class="formalpara"><p class="title"><strong>Example: Setting proxy variables using Helm Chart</strong></p><p>
										
<pre class="programlisting language-yaml">upstream:
  backstage:
    extraEnvVars:
      - name: HTTP_PROXY
        value: 'http://10.10.10.105:3128'
      - name: HTTPS_PROXY
        value: 'http://10.10.10.106:3128'
      - name: NO_PROXY
        value: 'localhost,example.org'</pre>
									</p></div></dd></dl></div></li><li class="listitem">
						Save the configuration changes.
					</li></ol></div></section></section><section class="chapter" id="proc-configuring-an-rhdh-instance-with-tls-in-kubernetes_running-behind-a-proxy"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Configuring an RHDH instance with a TLS connection in Kubernetes</h1></div></div></div><p>
			You can configure an RHDH instance with a Transport Layer Security (TLS) connection in a Kubernetes cluster, such as an Azure Red Hat OpenShift (ARO) cluster, any cluster from a supported cloud provider, or your own cluster with proper configuration. However, You must use a public Certificate Authority (CA)-signed certificate to configure your Kubernetes cluster.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					You have set up an Azure Red Hat OpenShift (ARO) cluster with a public CA-signed certificate. For more information about obtaining CA certificates, refer to your vendor documentation.
				</li><li class="listitem"><p class="simpara">
					You have created a namespace and setup a service account with proper read permissions on resources.
				</p><div class="formalpara"><p class="title"><strong>Example: Kubernetes manifest for role-based access control</strong></p><p>
						
<pre class="programlisting language-yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: backstage-read-only
rules:
  - apiGroups:
      - '*'
    resources:
      - pods
      - configmaps
      - services
      - deployments
      - replicasets
      - horizontalpodautoscalers
      - ingresses
      - statefulsets
      - limitranges
      - resourcequotas
      - daemonsets
    verbs:
      - get
      - list
      - watch
#...</pre>
					</p></div></li><li class="listitem">
					You have obtained the secret and the service CA certificate associated with your service account.
				</li><li class="listitem"><p class="simpara">
					You have created some resources and added annotations to them so they can be discovered by the Kubernetes plugin. You can apply these Kubernetes annotations:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
							<code class="literal">backstage.io/kubernetes-id</code> to label components
						</li><li class="listitem">
							<code class="literal">backstage.io/kubernetes-namespace</code> to label namespaces
						</li></ul></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
					Enable the Kubernetes plugins in the <code class="literal">dynamic-plugins-rhdh.yaml</code> file:
				</p><pre class="programlisting language-yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: dynamic-plugins-rhdh
data:
  dynamic-plugins.yaml: |
    includes:
      - dynamic-plugins.default.yaml
    plugins:
      - package: ./dynamic-plugins/dist/backstage-plugin-kubernetes-backend-dynamic
        disabled: false <span id="CO10-1"/><span class="callout">1</span>
      - package: ./dynamic-plugins/dist/backstage-plugin-kubernetes
        disabled: false <span id="CO10-2"/><span class="callout">2</span>
        # ...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO10-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Set the value to <code class="literal">false</code> to enable the <code class="literal">backstage-plugin-kubernetes-backend-dynamic</code> plugin.
						</div></dd><dt><a href="#CO10-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Set the value to <code class="literal">false</code> to enable the <code class="literal">backstage-plugin-kubernetes</code> plugin.
						</div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The <code class="literal">backstage-plugin-kubernetes</code> plugin is currently in <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview</a>. As an alternative, you can use the <code class="literal">./dynamic-plugins/dist/backstage-plugin-topology-dynamic</code> plugin, which is Generally Available (GA).
					</p></div></div></li><li class="listitem"><p class="simpara">
					Set the kubernetes cluster details and configure the catalog sync options in the <code class="literal">app-config-rhdh.yaml</code> file:
				</p><pre class="programlisting language-yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
  # ...
  catalog:
    rules:
      - allow: [Component, System, API, Resource, Location]
    providers:
      kubernetes:
        openshift:
          cluster: openshift
          processor:
            namespaceOverride: default
            defaultOwner: guests
          schedule:
            frequency:
              seconds: 30
            timeout:
              seconds: 5
  kubernetes:
    serviceLocatorMethod:
      type: 'multiTenant'
    clusterLocatorMethods:
      - type: 'config'
        clusters:
          - url: &lt;target-cluster-api-server-url&gt; <span id="CO11-1"/><span class="callout">1</span>
            name: openshift
            authProvider: 'serviceAccount'
            skipTLSVerify: false <span id="CO11-2"/><span class="callout">2</span>
            skipMetricsLookup: true
            dashboardUrl: &lt;target-cluster-console-url&gt; <span id="CO11-3"/><span class="callout">3</span>
            dashboardApp: openshift
            serviceAccountToken: ${K8S_SERVICE_ACCOUNT_TOKEN} <span id="CO11-4"/><span class="callout">4</span>
            caData: ${K8S_CONFIG_CA_DATA} <span id="CO11-5"/><span class="callout">5</span>
            # ...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO11-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							The base URL to the Kubernetes control plane. You can run the <code class="literal">kubectl cluster-info</code> command to get the base URL.
						</div></dd><dt><a href="#CO11-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Set the value of this parameter to <code class="literal">false</code> to enable the verification of the TLS certificate.
						</div></dd><dt><a href="#CO11-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Optional: The link to the Kubernetes dashboard managing the ARO cluster.
						</div></dd><dt><a href="#CO11-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							Optional: Pass the service account token using a <code class="literal">K8S_SERVICE_ACCOUNT_TOKEN</code> environment variable that you can define in your <code class="literal">secrets-rhdh</code> secret.
						</div></dd><dt><a href="#CO11-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Pass the CA data using a <code class="literal">K8S_CONFIG_CA_DATA</code> environment variable that you can define in your <code class="literal">secrets-rhdh</code> secret.
						</div></dd></dl></div></li><li class="listitem">
					Save the configuration changes.
				</li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
					Run the RHDH application to import your catalog:
				</p><pre class="programlisting language-terminal">kubectl -n rhdh-operator get pods -w</pre></li><li class="listitem">
					Verify that the pod log shows no errors for your configuration.
				</li><li class="listitem">
					Go to <span class="strong strong"><strong>Catalog</strong></span> and check the component page in the Developer Hub instance to verify the cluster connection and the presence of your created resources.
				</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				If you encounter connection errors, such as certificate issues or permissions, check the message box in the component page or view the logs of the pod.
			</p></div></div></section><section class="chapter" id="proc-rhdh-deployment-config_running-behind-a-proxy"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Configuring Red Hat Developer Hub deployment by using the operator</h1></div></div></div><p>
			The Red Hat Developer Hub operator exposes a <code class="literal">rhdh.redhat.com/v1alpha2</code> API Version of its Custom Resource Definition (CRD). This CRD exposes a generic <code class="literal">spec.deployment.patch</code> field, which gives you full control over the Developer Hub Deployment resource. This field can be a fragment of the standard <code class="literal">apps.Deployment</code> Kubernetes object.
		</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
					Create a Developer Hub Custom Resource Definition with the following fields:
				</li></ol></div><div class="formalpara"><p class="title"><strong>Example</strong></p><p>
				
<pre class="programlisting language-yaml">apiVersion: rhdh.redhat.com/v1alpha2
kind: Backstage
metadata:
  name: developer-hub
spec:
  deployment:
    patch:
      spec:
        template:</pre>
			</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">labels</code></span></dt><dd><p class="simpara">
						Add labels to the Developer Hub pod.
					</p><div class="formalpara"><p class="title"><strong>Example adding the label <code class="literal">my=true</code></strong></p><p>
							
<pre class="programlisting language-yaml">apiVersion: rhdh.redhat.com/v1alpha2
kind: Backstage
metadata:
  name: developer-hub
spec:
  deployment:
    patch:
      spec:
        template:
          metadata:
            labels:
              my: true</pre>
						</p></div></dd><dt><span class="term"><code class="literal">volumes</code></span></dt><dd><p class="simpara">
						Add an additional volume named <code class="literal">my-volume</code> and mount it under <code class="literal">/my/path</code> in the Developer Hub application container.
					</p><div class="formalpara"><p class="title"><strong>Example additional volume</strong></p><p>
							
<pre class="programlisting language-yaml">apiVersion: rhdh.redhat.com/v1alpha2
kind: Backstage
metadata:
  name: developer-hub
spec:
  deployment:
    patch:
      spec:
        template:
          spec:
            containers:
              - name: backstage-backend
                volumeMounts:
                  - mountPath: /my/path
                    name: my-volume
            volumes:
              - ephemeral:
                  volumeClaimTemplate:
                    spec:
                      storageClassName: "special"
                name: my-volume</pre>
						</p></div><p class="simpara">
						Replace the default <code class="literal">dynamic-plugins-root</code> volume with a persistent volume claim (PVC) named <code class="literal">dynamic-plugins-root</code>. Note the <code class="literal">$patch: replace</code> directive, otherwise a new volume will be added.
					</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">dynamic-plugins-root</code> volume replacement</strong></p><p>
							
<pre class="programlisting language-yaml">apiVersion: rhdh.redhat.com/v1alpha2
kind: Backstage
metadata:
  name: developer-hub
spec:
  deployment:
    patch:
      spec:
        template:
          spec:
            volumes:
              - $patch: replace
                name: dynamic-plugins-root
                persistentVolumeClaim:
                  claimName: dynamic-plugins-root</pre>
						</p></div></dd><dt><span class="term"><code class="literal">cpu</code> request</span></dt><dd><p class="simpara">
						Set the CPU request for the Developer Hub application container to 250m.
					</p><div class="formalpara"><p class="title"><strong>Example CPU request</strong></p><p>
							
<pre class="programlisting language-yaml">apiVersion: rhdh.redhat.com/v1alpha2
kind: Backstage
metadata:
  name: developer-hub
spec:
  deployment:
    patch:
      spec:
        template:
          spec:
            containers:
              - name: backstage-backend
                resources:
                  requests:
                    cpu: 250m</pre>
						</p></div></dd><dt><span class="term"><code class="literal">my-sidecar</code> container</span></dt><dd><p class="simpara">
						Add a new <code class="literal">my-sidecar</code> sidecar container into the Developer Hub Pod.
					</p><div class="formalpara"><p class="title"><strong>Example side car container</strong></p><p>
							
<pre class="programlisting language-yaml">apiVersion: rhdh.redhat.com/v1alpha2
kind: Backstage
metadata:
  name: developer-hub
spec:
  deployment:
    patch:
      spec:
        template:
          spec:
            containers:
              - name: my-sidecar
                image: quay.io/my-org/my-sidecar:latest</pre>
						</p></div></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
					To learn more about merging, see <a class="link" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-api-machinery/strategic-merge-patch.md#basic-patch-format">Strategic Merge Patch</a>.
				</li></ul></div></section><div><div xml:lang="en-US" class="legalnotice" id="idm45552314718416"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"/>© 2024 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>