<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" class="chrometwo"><head><title>Configuring TLS</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css"/><meta name="generator" content="publican v4.3.2"/><meta name="description" content="You can configure an Red Hat Developer Hub instance with a Transport Layer Security (TLS) connection in a Kubernetes cluster."/><link rel="next" href="#idm45077455992208" title="Preface"/><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><script type="text/javascript" src="Common_Content/scripts/jquery-1.7.1.min.js"> </script><script type="text/javascript" src="Common_Content/scripts/utils.js"> </script><script type="text/javascript" src="Common_Content/scripts/highlight.js/highlight.pack.js"> </script></head><body><div id="chrometwo"><div id="main"><div xml:lang="en-US" class="book" id="idm45077457365248"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red Hat Developer Hub</span> <span class="productnumber">1.4</span></div><div><h1 class="title">Configuring TLS</h1></div><div><h2 class="subtitle">Configuring Red Hat Developer Hub with a TLS connection in Kubernetes</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm45077439019984">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				You can configure an Red Hat Developer Hub instance with a Transport Layer Security (TLS) connection in a Kubernetes cluster.
			</div></div></div></div><hr/></div><div class="toc"><ul class="toc"><li><span class="preface"><a href="#idm45077455992208">Preface</a></span></li></ul></div><section class="preface" id="idm45077455992208"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p>
			You can configure an RHDH instance with a Transport Layer Security (TLS) connection in a Kubernetes cluster, such as an Azure Red Hat OpenShift (ARO) cluster, any cluster from a supported cloud provider, or your own cluster with proper configuration. However, You must use a public Certificate Authority (CA)-signed certificate to configure your Kubernetes cluster.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					You have set up an Azure Red Hat OpenShift (ARO) cluster with a public CA-signed certificate. For more information about obtaining CA certificates, refer to your vendor documentation.
				</li><li class="listitem"><p class="simpara">
					You have created a namespace and setup a service account with proper read permissions on resources.
				</p><div class="formalpara"><p class="title"><strong>Example: Kubernetes manifest for role-based access control</strong></p><p>
						
<pre class="programlisting language-yaml">apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: backstage-read-only
rules:
  - apiGroups:
      - '*'
    resources:
      - pods
      - configmaps
      - services
      - deployments
      - replicasets
      - horizontalpodautoscalers
      - ingresses
      - statefulsets
      - limitranges
      - resourcequotas
      - daemonsets
    verbs:
      - get
      - list
      - watch
#...</pre>
					</p></div></li><li class="listitem">
					You have obtained the secret and the service CA certificate associated with your service account.
				</li><li class="listitem"><p class="simpara">
					You have created some resources and added annotations to them so they can be discovered by the Kubernetes plugin. You can apply these Kubernetes annotations:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
							<code class="literal">backstage.io/kubernetes-id</code> to label components
						</li><li class="listitem">
							<code class="literal">backstage.io/kubernetes-namespace</code> to label namespaces
						</li></ul></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
					Enable the Kubernetes plugins in the <code class="literal">dynamic-plugins-rhdh.yaml</code> file:
				</p><pre class="programlisting language-yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: dynamic-plugins-rhdh
data:
  dynamic-plugins.yaml: |
    includes:
      - dynamic-plugins.default.yaml
    plugins:
      - package: ./dynamic-plugins/dist/backstage-plugin-kubernetes-backend-dynamic
        disabled: false <span id="CO1-1"/><span class="callout">1</span>
      - package: ./dynamic-plugins/dist/backstage-plugin-kubernetes
        disabled: false <span id="CO1-2"/><span class="callout">2</span>
        # ...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO1-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							Set the value to <code class="literal">false</code> to enable the <code class="literal">backstage-plugin-kubernetes-backend-dynamic</code> plugin.
						</div></dd><dt><a href="#CO1-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Set the value to <code class="literal">false</code> to enable the <code class="literal">backstage-plugin-kubernetes</code> plugin.
						</div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The <code class="literal">backstage-plugin-kubernetes</code> plugin is currently in <a class="link" href="https://access.redhat.com/support/offerings/techpreview">Technology Preview</a>. As an alternative, you can use the <code class="literal">./dynamic-plugins/dist/backstage-plugin-topology-dynamic</code> plugin, which is Generally Available (GA).
					</p></div></div></li><li class="listitem"><p class="simpara">
					Set the kubernetes cluster details and configure the catalog sync options in the <code class="literal">app-config-rhdh.yaml</code> file:
				</p><pre class="programlisting language-yaml">kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
data:
  "app-config-rhdh.yaml": |
  # ...
  catalog:
    rules:
      - allow: [Component, System, API, Resource, Location]
    providers:
      kubernetes:
        openshift:
          cluster: openshift
          processor:
            namespaceOverride: default
            defaultOwner: guests
          schedule:
            frequency:
              seconds: 30
            timeout:
              seconds: 5
  kubernetes:
    serviceLocatorMethod:
      type: 'multiTenant'
    clusterLocatorMethods:
      - type: 'config'
        clusters:
          - url: &lt;target-cluster-api-server-url&gt; <span id="CO2-1"/><span class="callout">1</span>
            name: openshift
            authProvider: 'serviceAccount'
            skipTLSVerify: false <span id="CO2-2"/><span class="callout">2</span>
            skipMetricsLookup: true
            dashboardUrl: &lt;target-cluster-console-url&gt; <span id="CO2-3"/><span class="callout">3</span>
            dashboardApp: openshift
            serviceAccountToken: ${K8S_SERVICE_ACCOUNT_TOKEN} <span id="CO2-4"/><span class="callout">4</span>
            caData: ${K8S_CONFIG_CA_DATA} <span id="CO2-5"/><span class="callout">5</span>
            # ...</pre><div class="calloutlist"><dl class="calloutlist"><dt><a href="#CO2-1"><span class="callout">1</span></a> </dt><dd><div class="para">
							The base URL to the Kubernetes control plane. You can run the <code class="literal">kubectl cluster-info</code> command to get the base URL.
						</div></dd><dt><a href="#CO2-2"><span class="callout">2</span></a> </dt><dd><div class="para">
							Set the value of this parameter to <code class="literal">false</code> to enable the verification of the TLS certificate.
						</div></dd><dt><a href="#CO2-3"><span class="callout">3</span></a> </dt><dd><div class="para">
							Optional: The link to the Kubernetes dashboard managing the ARO cluster.
						</div></dd><dt><a href="#CO2-4"><span class="callout">4</span></a> </dt><dd><div class="para">
							Optional: Pass the service account token using a <code class="literal">K8S_SERVICE_ACCOUNT_TOKEN</code> environment variable that you can define in your <code class="literal">secrets-rhdh</code> secret.
						</div></dd><dt><a href="#CO2-5"><span class="callout">5</span></a> </dt><dd><div class="para">
							Pass the CA data using a <code class="literal">K8S_CONFIG_CA_DATA</code> environment variable that you can define in your <code class="literal">secrets-rhdh</code> secret.
						</div></dd></dl></div></li><li class="listitem">
					Save the configuration changes.
				</li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
					Run the RHDH application to import your catalog:
				</p><pre class="programlisting language-terminal">kubectl -n rhdh-operator get pods -w</pre></li><li class="listitem">
					Verify that the pod log shows no errors for your configuration.
				</li><li class="listitem">
					Go to <span class="strong strong"><strong>Catalog</strong></span> and check the component page in the Developer Hub instance to verify the cluster connection and the presence of your created resources.
				</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				If you encounter connection errors, such as certificate issues or permissions, check the message box in the component page or view the logs of the pod.
			</p></div></div></section><div><div xml:lang="en-US" class="legalnotice" id="idm45077439019984"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"/>© 2024 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></div></div><script type="text/javascript">
                        jQuery(document).ready(function() {
                            initSwitchery();
                            jQuery('pre[class*="language-"]').each(function(i, block){hljs.highlightBlock(block);});
                        });
                    </script></body></html>